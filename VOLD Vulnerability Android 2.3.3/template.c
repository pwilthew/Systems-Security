#include <stdio.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <sys/mount.h>
#include <sys/time.h>
#include <linux/netlink.h>
#include <sys/socket.h>
#include <sys/un.h>
#include <arpa/inet.h>
#include <unistd.h>
#include <fcntl.h>
#include <errno.h>
#include <string.h>
#include <signal.h>
#include <stdlib.h>
#include <math.h>
#include <dlfcn.h>
#include <elf.h>

static void die(const char *msg)
{
    perror(msg);
    exit(errno);
}

static int send_msgs(uint32_t idx, uint32_t pid)
{

  //*****************************************************************
    char buf[0x1000]; // buf should contain the string you crafted.
  //*****************************************************************
    
    struct sockaddr_nl snl;
    struct iovec iov = {buf, sizeof(buf)};
    struct msghdr msg = {&snl, sizeof(snl), &iov, 1, NULL, 0, 0};
    int sock = -1, n = 0;
    
    usleep(200000);
    memset(buf, 0, sizeof(buf));
    memset(&snl, 0, sizeof(snl));
    snl.nl_family = AF_NETLINK;
    
    // Open socket to talk to vold via netlink
    if ((sock = socket(PF_NETLINK, SOCK_DGRAM, NETLINK_KOBJECT_UEVENT)) < 0)
        die("[-] socket");
    snl.nl_pid = pid;
    
    //**********************************************************************
    //****Write your code here to craft first string and write into *buf****
    //**********************************************************************

    // ......

    //**********************************************************************
    
    msg.msg_iov->iov_len = /* put your first string's length here. */;

    //**********************************************************************
    
    n = sendmsg(sock, &msg, 0);
    if (n < 0) {
        close(sock);
        return n;
    }
    
    usleep(500000);

    //***************************************************************************
    //****Write your code here to craft the second string and write into *buf****
    //***************************************************************************
    
    // ......

    //**********************************************************************

    msg.msg_iov->iov_len = /* put your second string's length here. */;

    //**********************************************************************
    
    n = sendmsg(sock, &msg, 0);
    
    close(sock);
    
    return n;
}

int main(int argc, char **argv, char **env)
{
    //****Write your code here to get user input, caculate idx and send_msgs****
    //Usage: template <GOT_ADDR> <PTR_ADDR> <PID_vold>
    
    return 0;
}
